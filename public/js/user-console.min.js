var app = angular.module("user-console",["treeControl",'ngRoute']);

/*
app.run(["$rootScope","$location", function($rootScope, $location){
    $rootScope['user-console-globals']['$location'] = $location;
}])

*/


var uMap = {
        '':{ label:"Главная","controller": 'rootCont', "templateUrl":"/templates/Root.html"},
        "assets":{ label:"Активы", "controller": 'UserAllAssets', "templateUrl":"/templates/UserAllAssets.html"},
        "ships":{ label:"Мои корабли", "parent":"assets", "controller": 'UserShips', "templateUrl":"/templates/UserShips.html"},
        "goods":{ label:"Разные вещи", "parent":"assets", "controller": 'UserAssets', "templateUrl":"/templates/UserAssets.html"},
        
        "market":{ label:"Рынок", "controller": 'MarketCont', "templateUrl":"/templates/Market.html"},
        "production":{ label:"Производство", "controller": 'ProductionCont', "templateUrl":"/templates/Production.html"},
        "ownProd":{ label:"Собственные фабрики", parent:'production',  "controller": 'OwnPlantsCont', "templateUrl":"/templates/OwnPlants.html"},
        
        "missions":{ label:"Миссии", "controller": 'MissionsCont', "templateUrl":"/templates/Missions.html"},
        "mission-constructor":{ label:"Конструктор миссий", parent:'missions', "controller": 'MissionConstructorCont', "templateUrl":"/templates/MissionConstructor.html"}
        
}

app.constant("moduleUrlMap", uMap)


var getUrls = function(map){
    var url_list = {}

    var getUrl = function(addr, obj, map){
        var na = obj.parent;
        if (parent in map[na]){
            root = getUrl(na, map[na], map);
        }else{
            root = '/';
        }
        return root + na + "/" +addr;
    }

    for(var addr in map){
        var obj = map[addr];
        if('parent' in obj){
            var u = getUrl(addr, obj, map);
        }else{
            var u = "/" + addr;
        }
        // console.log("R",u);
        var no = {url:u, _name: addr,  label:obj.label, ang:{controller:obj.controller, templateUrl:obj.templateUrl }};
        if('parent' in obj){
            no.parent = obj.parent;
        }
        url_list[u] = no;
    }
    return url_list;

}
var getUrlTree = function(map){
    // Надо составить индекс типа
    // {"/url/":[1,2] } - Цифры - это индексы итемов в дереве с чилдренами
    var tree = [];
    var objs = {};
    var roots = [];
    for (var item  in map){
        var obj = map[item];
        obj.children = []
        objs[obj._name] = obj;
        if('parent' in obj){
            // console.log("objs", objs, obj.parent, obj._name);
            objs[obj.parent].children.push(obj);
            // console.log(objs[obj.parent].children);
        }else{
            roots.push(obj._name);
            
        };
    }
    var rtree = [];
    for(var r in roots){
        // console.log("fuck", r);
        rtree.push( objs[roots[r]])
        
    }
    return rtree;
    
}
// getUrlTree(getUrls(uMap));

app.constant("moduleUrls", getUrls(uMap));
app.constant("navTree", getUrlTree(getUrls(uMap) ) );

app.config(["$routeProvider", "moduleUrlMap",  function($routeProvider, moduleUrlMap){
    
    var rp = $routeProvider;
    var map  = getUrls(moduleUrlMap);
    // console.log(">>", map);
    for(var url in map){
        // console.log(url);
        rp =  rp.when(url, map[url].ang)
    }
    // rp.otherwise({redirectTo:"/"})

}]);


app.controller("userConstructionCont", ["$scope","socketListeners", function($scope,  ws){
    
    ws.register("bookmarked-objects", function(message){
        console.log(message);
        $scope.bookmarkedObjects = message.objects;
        
    })
    
}])
app.controller('UserAllAssets', ["$scope", "socketPromise", function($scope, socketPromise){
    socketPromise.get("A", {user_id: true }).then(function(res){
        $scope.assets = res;
        // console.log("RESOLVED", res)
    });
    $scope.d = ["a"]
    
    $scope.connect = function(position){
        // TODO Убрать возможность нажимать на кнопку еще хоть раз
        // TODO Заставлять гореть эту кнопку только если действительно не подключен     
        console.log("connect recv");
        position.user_id = true;
        socketPromise.request("C", position).then(function(res){
            console.log("something to return", res);
        })
        // console.log(position);
    }
    
    $scope.shippositions = function(ship){
        //console.log(">>G", ship);
        socketPromise.get("T", {"type": ship.ship_type} ).then(function(res){
            // console.log(res);
            $scope.positions =[]
            angular.forEach(res.workpoints, function(wp, wp_name){
                $scope.positions.push({name:wp_name, type:wp.type, object_guid: ship.GUID});
            })
        })
    }
    
    
}])

//app.controller("ShipPositionCont", ["$scope", "socketPromise", function($scope, socketPromise){
// }])

app.controller("rootCont", function($scope){
    $scope.hello = "Hello";
})
app.controller('consoleBrowser',['$scope', "$log", "$location", 'navTree',function($scope, $log, $location, navTree){
    $scope.vaar = "Hello cont";
    $log.log($location.path());
    $scope.location = $location;
   // $scope.route = r;
//     $scope.routeProvider = rp;

    //console.log("navTree", navTree);
    $scope.dataForTheTree = navTree;

    $scope.selected_node = navTree[1];
    
    $scope.showSelected = function(node){
        $log.log("showSelected", node);
        $location.url(node.url);
        
    }
    
}] );



app.service('authHash',['$http', '$log', function($http, $log){
    return {
        is_inited:false,
        _hash:null,
        _init:function(cb){
            if (this.is_inited){ return; }
            var that = this;
            this._hash = $http.get( '/my-auth-hash/')
            .then(function(resp){
                // $log.log("ah", resp);
                // that._hash = data.hash;
                cb(resp.data.hash, resp.data.user_id)
                
            })
            this.is_inited = true;
            
        },
        get: function( cb ){
            this._init( cb )
            //$log.log("L",this.q, this._hash);
            return this._hash; 
        },
    }
  }] )

app.factory('socket', ["$rootScope", "$q", "authHash",function ($rootScope,$q, authHash) {
    var socket = io.connect();
    is_authenticated = $q.defer();
    socket.on('connected', function(){
        // console.log("reconnection");
        authHash.get(function(hash, uid){
            socket.emit("auth_hash_console", {auth: hash});
        })
    })
    socket.on("auth_completed", function(msg){
        if(msg.err){
            is_authenticated.reject(msg.err);
        }else{
            is_authenticated.resolve();            
        }
        
    })
    // console.log(is_authenticated);
    is_authenticated.promise.then(function(){console.log("auth")})
    
    
  return {
    getState: function(){return "good"},
    on: function (eventName, callback) {
      socket.on(eventName, function () {  
        var args = arguments;
        $rootScope.$apply(function () {
          callback.apply(socket, args);
        });
      });
    },
    emit: function (eventName, data, callback) {
      
      socket.emit(eventName, data, function () {
        var args = arguments;
        // console.log("emitted");
        $rootScope.$apply(function () {
          if (callback) {
            callback.apply(socket, args);
          }
        });
      })
    }
  };
} ]);

app.factory("socketPromise",["$q", "$rootScope", "authHash", function( $q, $rootScope, authHash){
    var socket = io.connect();
    var is_ready = false;
    var Queue = [];
    
    is_authenticated = $q.defer();
    socket.on('connected', function(){
        // console.log("reconnection");
        authHash.get(function(hash, uid){
            socket.emit("auth_hash_console", {auth: hash});
        })
    })
    socket.on("auth_completed", function(msg){
        if(msg.err){
            is_authenticated.reject(msg.err);
        }else{
            console.log(">>");
            $rootScope.$apply(function(){is_authenticated.resolve(true)})
        }
        
    })
    // console.log(is_authenticated);
    is_authenticated.promise.then(function(s,e){
        // console.log(is_authenticated, s,e);
        is_ready = true;
        for(var i =0;i <Queue.length; i++){
            socket.emit(Queue[i].T, Queue[i].p);
        }
    })
    
    var S = {};
    var cbs = {};
    var curcbix = 0;
    function getCBIx(){
        curcbix+=1;
        return curcbix % 10000;
    };
    
    var Req = function(mt, t, p){
        var d = $q.defer(),
        cbix =  getCBIx();
        cbs[cbix] = {
            cb: d
        }
        var o = {p:p};
        o.cbix = cbix;
        o.T = t;
        if(!is_ready){
            Queue.push({T:mt,p:o});
            
        }else{
            socket.emit(mt, o);
            
        }

        return d.promise;
    }
    
    var messages_to_hear = ["Q", "R"];
    angular.forEach(messages_to_hear, function(message_type){
        socket.on(message_type, function(msg){
            // console.log(">>>", msg);
            var cbix = msg.cbix;
            if(cbs.hasOwnProperty(cbix)) {
                $rootScope.$apply(cbs[cbix].cb.resolve(msg.d));
                delete cbs[cbix];
            }
        })
        
    })
    
    S.get = function(t,p){
        return Req("Q", t,p)
    }
    S.request = function(t,p){
        return Req("R", t,p)
    }
    return S;
}])

app.service("socketListeners",['socket', function(socket){
    // Здесь мы хотим создать службы, которая регистрирует несколько обновлений на любые входящие socket.io запросы
    var Listeners = {
        _listeners : {}
    }
    Listeners.register = function(eventType, cb) {
        if(this._listeners[eventType] == null){
            this._listeners[eventType] = [cb];
            return 0;
        }else{
            return this._listeners[eventType].push(cb) - 1; // current item index
        }
    }
    socket.on("W", function(message){
        var message_type = message.type;
        
        angular.forEach(Listeners._listeners[message_type], function(listener){
            listener(message);
        })
        
    })
    
    return Listeners;
    
    
}])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnN0cnVjdGlvbi5qcyIsImNvbnRyb2xsZXJzLmpzIiwidHJlZXZpZXcuanMiLCJ3ZWJzb2NrZXQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InVzZXItY29uc29sZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoXCJ1c2VyLWNvbnNvbGVcIixbXCJ0cmVlQ29udHJvbFwiLCduZ1JvdXRlJ10pO1xuXG4vKlxuYXBwLnJ1bihbXCIkcm9vdFNjb3BlXCIsXCIkbG9jYXRpb25cIiwgZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKXtcbiAgICAkcm9vdFNjb3BlWyd1c2VyLWNvbnNvbGUtZ2xvYmFscyddWyckbG9jYXRpb24nXSA9ICRsb2NhdGlvbjtcbn1dKVxuXG4qL1xuXG5cbnZhciB1TWFwID0ge1xuICAgICAgICAnJzp7IGxhYmVsOlwi0JPQu9Cw0LLQvdCw0Y9cIixcImNvbnRyb2xsZXJcIjogJ3Jvb3RDb250JywgXCJ0ZW1wbGF0ZVVybFwiOlwiL3RlbXBsYXRlcy9Sb290Lmh0bWxcIn0sXG4gICAgICAgIFwiYXNzZXRzXCI6eyBsYWJlbDpcItCQ0LrRgtC40LLRi1wiLCBcImNvbnRyb2xsZXJcIjogJ1VzZXJBbGxBc3NldHMnLCBcInRlbXBsYXRlVXJsXCI6XCIvdGVtcGxhdGVzL1VzZXJBbGxBc3NldHMuaHRtbFwifSxcbiAgICAgICAgXCJzaGlwc1wiOnsgbGFiZWw6XCLQnNC+0Lgg0LrQvtGA0LDQsdC70LhcIiwgXCJwYXJlbnRcIjpcImFzc2V0c1wiLCBcImNvbnRyb2xsZXJcIjogJ1VzZXJTaGlwcycsIFwidGVtcGxhdGVVcmxcIjpcIi90ZW1wbGF0ZXMvVXNlclNoaXBzLmh0bWxcIn0sXG4gICAgICAgIFwiZ29vZHNcIjp7IGxhYmVsOlwi0KDQsNC30L3Ri9C1INCy0LXRidC4XCIsIFwicGFyZW50XCI6XCJhc3NldHNcIiwgXCJjb250cm9sbGVyXCI6ICdVc2VyQXNzZXRzJywgXCJ0ZW1wbGF0ZVVybFwiOlwiL3RlbXBsYXRlcy9Vc2VyQXNzZXRzLmh0bWxcIn0sXG4gICAgICAgIFxuICAgICAgICBcIm1hcmtldFwiOnsgbGFiZWw6XCLQoNGL0L3QvtC6XCIsIFwiY29udHJvbGxlclwiOiAnTWFya2V0Q29udCcsIFwidGVtcGxhdGVVcmxcIjpcIi90ZW1wbGF0ZXMvTWFya2V0Lmh0bWxcIn0sXG4gICAgICAgIFwicHJvZHVjdGlvblwiOnsgbGFiZWw6XCLQn9GA0L7QuNC30LLQvtC00YHRgtCy0L5cIiwgXCJjb250cm9sbGVyXCI6ICdQcm9kdWN0aW9uQ29udCcsIFwidGVtcGxhdGVVcmxcIjpcIi90ZW1wbGF0ZXMvUHJvZHVjdGlvbi5odG1sXCJ9LFxuICAgICAgICBcIm93blByb2RcIjp7IGxhYmVsOlwi0KHQvtCx0YHRgtCy0LXQvdC90YvQtSDRhNCw0LHRgNC40LrQuFwiLCBwYXJlbnQ6J3Byb2R1Y3Rpb24nLCAgXCJjb250cm9sbGVyXCI6ICdPd25QbGFudHNDb250JywgXCJ0ZW1wbGF0ZVVybFwiOlwiL3RlbXBsYXRlcy9Pd25QbGFudHMuaHRtbFwifSxcbiAgICAgICAgXG4gICAgICAgIFwibWlzc2lvbnNcIjp7IGxhYmVsOlwi0JzQuNGB0YHQuNC4XCIsIFwiY29udHJvbGxlclwiOiAnTWlzc2lvbnNDb250JywgXCJ0ZW1wbGF0ZVVybFwiOlwiL3RlbXBsYXRlcy9NaXNzaW9ucy5odG1sXCJ9LFxuICAgICAgICBcIm1pc3Npb24tY29uc3RydWN0b3JcIjp7IGxhYmVsOlwi0JrQvtC90YHRgtGA0YPQutGC0L7RgCDQvNC40YHRgdC40LlcIiwgcGFyZW50OidtaXNzaW9ucycsIFwiY29udHJvbGxlclwiOiAnTWlzc2lvbkNvbnN0cnVjdG9yQ29udCcsIFwidGVtcGxhdGVVcmxcIjpcIi90ZW1wbGF0ZXMvTWlzc2lvbkNvbnN0cnVjdG9yLmh0bWxcIn1cbiAgICAgICAgXG59XG5cbmFwcC5jb25zdGFudChcIm1vZHVsZVVybE1hcFwiLCB1TWFwKVxuXG5cbnZhciBnZXRVcmxzID0gZnVuY3Rpb24obWFwKXtcbiAgICB2YXIgdXJsX2xpc3QgPSB7fVxuXG4gICAgdmFyIGdldFVybCA9IGZ1bmN0aW9uKGFkZHIsIG9iaiwgbWFwKXtcbiAgICAgICAgdmFyIG5hID0gb2JqLnBhcmVudDtcbiAgICAgICAgaWYgKHBhcmVudCBpbiBtYXBbbmFdKXtcbiAgICAgICAgICAgIHJvb3QgPSBnZXRVcmwobmEsIG1hcFtuYV0sIG1hcCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcm9vdCA9ICcvJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcm9vdCArIG5hICsgXCIvXCIgK2FkZHI7XG4gICAgfVxuXG4gICAgZm9yKHZhciBhZGRyIGluIG1hcCl7XG4gICAgICAgIHZhciBvYmogPSBtYXBbYWRkcl07XG4gICAgICAgIGlmKCdwYXJlbnQnIGluIG9iail7XG4gICAgICAgICAgICB2YXIgdSA9IGdldFVybChhZGRyLCBvYmosIG1hcCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIHUgPSBcIi9cIiArIGFkZHI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJSXCIsdSk7XG4gICAgICAgIHZhciBubyA9IHt1cmw6dSwgX25hbWU6IGFkZHIsICBsYWJlbDpvYmoubGFiZWwsIGFuZzp7Y29udHJvbGxlcjpvYmouY29udHJvbGxlciwgdGVtcGxhdGVVcmw6b2JqLnRlbXBsYXRlVXJsIH19O1xuICAgICAgICBpZigncGFyZW50JyBpbiBvYmope1xuICAgICAgICAgICAgbm8ucGFyZW50ID0gb2JqLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICB1cmxfbGlzdFt1XSA9IG5vO1xuICAgIH1cbiAgICByZXR1cm4gdXJsX2xpc3Q7XG5cbn1cbnZhciBnZXRVcmxUcmVlID0gZnVuY3Rpb24obWFwKXtcbiAgICAvLyDQndCw0LTQviDRgdC+0YHRgtCw0LLQuNGC0Ywg0LjQvdC00LXQutGBINGC0LjQv9CwXG4gICAgLy8ge1wiL3VybC9cIjpbMSwyXSB9IC0g0KbQuNGE0YDRiyAtINGN0YLQviDQuNC90LTQtdC60YHRiyDQuNGC0LXQvNC+0LIg0LIg0LTQtdGA0LXQstC1INGBINGH0LjQu9C00YDQtdC90LDQvNC4XG4gICAgdmFyIHRyZWUgPSBbXTtcbiAgICB2YXIgb2JqcyA9IHt9O1xuICAgIHZhciByb290cyA9IFtdO1xuICAgIGZvciAodmFyIGl0ZW0gIGluIG1hcCl7XG4gICAgICAgIHZhciBvYmogPSBtYXBbaXRlbV07XG4gICAgICAgIG9iai5jaGlsZHJlbiA9IFtdXG4gICAgICAgIG9ianNbb2JqLl9uYW1lXSA9IG9iajtcbiAgICAgICAgaWYoJ3BhcmVudCcgaW4gb2JqKXtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwib2Jqc1wiLCBvYmpzLCBvYmoucGFyZW50LCBvYmouX25hbWUpO1xuICAgICAgICAgICAgb2Jqc1tvYmoucGFyZW50XS5jaGlsZHJlbi5wdXNoKG9iaik7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhvYmpzW29iai5wYXJlbnRdLmNoaWxkcmVuKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICByb290cy5wdXNoKG9iai5fbmFtZSk7XG4gICAgICAgICAgICBcbiAgICAgICAgfTtcbiAgICB9XG4gICAgdmFyIHJ0cmVlID0gW107XG4gICAgZm9yKHZhciByIGluIHJvb3RzKXtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJmdWNrXCIsIHIpO1xuICAgICAgICBydHJlZS5wdXNoKCBvYmpzW3Jvb3RzW3JdXSlcbiAgICAgICAgXG4gICAgfVxuICAgIHJldHVybiBydHJlZTtcbiAgICBcbn1cbi8vIGdldFVybFRyZWUoZ2V0VXJscyh1TWFwKSk7XG5cbmFwcC5jb25zdGFudChcIm1vZHVsZVVybHNcIiwgZ2V0VXJscyh1TWFwKSk7XG5hcHAuY29uc3RhbnQoXCJuYXZUcmVlXCIsIGdldFVybFRyZWUoZ2V0VXJscyh1TWFwKSApICk7XG5cbmFwcC5jb25maWcoW1wiJHJvdXRlUHJvdmlkZXJcIiwgXCJtb2R1bGVVcmxNYXBcIiwgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCBtb2R1bGVVcmxNYXApe1xuICAgIFxuICAgIHZhciBycCA9ICRyb3V0ZVByb3ZpZGVyO1xuICAgIHZhciBtYXAgID0gZ2V0VXJscyhtb2R1bGVVcmxNYXApO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiPj5cIiwgbWFwKTtcbiAgICBmb3IodmFyIHVybCBpbiBtYXApe1xuICAgICAgICAvLyBjb25zb2xlLmxvZyh1cmwpO1xuICAgICAgICBycCA9ICBycC53aGVuKHVybCwgbWFwW3VybF0uYW5nKVxuICAgIH1cbiAgICAvLyBycC5vdGhlcndpc2Uoe3JlZGlyZWN0VG86XCIvXCJ9KVxuXG59XSk7XG5cbiIsImFwcC5jb250cm9sbGVyKFwidXNlckNvbnN0cnVjdGlvbkNvbnRcIiwgW1wiJHNjb3BlXCIsXCJzb2NrZXRMaXN0ZW5lcnNcIiwgZnVuY3Rpb24oJHNjb3BlLCAgd3Mpe1xuICAgIFxuICAgIHdzLnJlZ2lzdGVyKFwiYm9va21hcmtlZC1vYmplY3RzXCIsIGZ1bmN0aW9uKG1lc3NhZ2Upe1xuICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICAgICAgJHNjb3BlLmJvb2ttYXJrZWRPYmplY3RzID0gbWVzc2FnZS5vYmplY3RzO1xuICAgICAgICBcbiAgICB9KVxuICAgIFxufV0pIiwiYXBwLmNvbnRyb2xsZXIoJ1VzZXJBbGxBc3NldHMnLCBbXCIkc2NvcGVcIiwgXCJzb2NrZXRQcm9taXNlXCIsIGZ1bmN0aW9uKCRzY29wZSwgc29ja2V0UHJvbWlzZSl7XG4gICAgc29ja2V0UHJvbWlzZS5nZXQoXCJBXCIsIHt1c2VyX2lkOiB0cnVlIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgJHNjb3BlLmFzc2V0cyA9IHJlcztcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJSRVNPTFZFRFwiLCByZXMpXG4gICAgfSk7XG4gICAgJHNjb3BlLmQgPSBbXCJhXCJdXG4gICAgXG4gICAgJHNjb3BlLmNvbm5lY3QgPSBmdW5jdGlvbihwb3NpdGlvbil7XG4gICAgICAgIC8vIFRPRE8g0KPQsdGA0LDRgtGMINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0L3QsNC20LjQvNCw0YLRjCDQvdCwINC60L3QvtC/0LrRgyDQtdGJ0LUg0YXQvtGC0Ywg0YDQsNC3XG4gICAgICAgIC8vIFRPRE8g0JfQsNGB0YLQsNCy0LvRj9GC0Ywg0LPQvtGA0LXRgtGMINGN0YLRgyDQutC90L7Qv9C60YMg0YLQvtC70YzQutC+INC10YHQu9C4INC00LXQudGB0YLQstC40YLQtdC70YzQvdC+INC90LUg0L/QvtC00LrQu9GO0YfQtdC9ICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJjb25uZWN0IHJlY3ZcIik7XG4gICAgICAgIHBvc2l0aW9uLnVzZXJfaWQgPSB0cnVlO1xuICAgICAgICBzb2NrZXRQcm9taXNlLnJlcXVlc3QoXCJDXCIsIHBvc2l0aW9uKS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInNvbWV0aGluZyB0byByZXR1cm5cIiwgcmVzKTtcbiAgICAgICAgfSlcbiAgICAgICAgLy8gY29uc29sZS5sb2cocG9zaXRpb24pO1xuICAgIH1cbiAgICBcbiAgICAkc2NvcGUuc2hpcHBvc2l0aW9ucyA9IGZ1bmN0aW9uKHNoaXApe1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwiPj5HXCIsIHNoaXApO1xuICAgICAgICBzb2NrZXRQcm9taXNlLmdldChcIlRcIiwge1widHlwZVwiOiBzaGlwLnNoaXBfdHlwZX0gKS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgICAgJHNjb3BlLnBvc2l0aW9ucyA9W11cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyZXMud29ya3BvaW50cywgZnVuY3Rpb24od3AsIHdwX25hbWUpe1xuICAgICAgICAgICAgICAgICRzY29wZS5wb3NpdGlvbnMucHVzaCh7bmFtZTp3cF9uYW1lLCB0eXBlOndwLnR5cGUsIG9iamVjdF9ndWlkOiBzaGlwLkdVSUR9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuICAgIFxuICAgIFxufV0pXG5cbi8vYXBwLmNvbnRyb2xsZXIoXCJTaGlwUG9zaXRpb25Db250XCIsIFtcIiRzY29wZVwiLCBcInNvY2tldFByb21pc2VcIiwgZnVuY3Rpb24oJHNjb3BlLCBzb2NrZXRQcm9taXNlKXtcbi8vIH1dKVxuXG5hcHAuY29udHJvbGxlcihcInJvb3RDb250XCIsIGZ1bmN0aW9uKCRzY29wZSl7XG4gICAgJHNjb3BlLmhlbGxvID0gXCJIZWxsb1wiO1xufSkiLCJhcHAuY29udHJvbGxlcignY29uc29sZUJyb3dzZXInLFsnJHNjb3BlJywgXCIkbG9nXCIsIFwiJGxvY2F0aW9uXCIsICduYXZUcmVlJyxmdW5jdGlvbigkc2NvcGUsICRsb2csICRsb2NhdGlvbiwgbmF2VHJlZSl7XG4gICAgJHNjb3BlLnZhYXIgPSBcIkhlbGxvIGNvbnRcIjtcbiAgICAkbG9nLmxvZygkbG9jYXRpb24ucGF0aCgpKTtcbiAgICAkc2NvcGUubG9jYXRpb24gPSAkbG9jYXRpb247XG4gICAvLyAkc2NvcGUucm91dGUgPSByO1xuLy8gICAgICRzY29wZS5yb3V0ZVByb3ZpZGVyID0gcnA7XG5cbiAgICAvL2NvbnNvbGUubG9nKFwibmF2VHJlZVwiLCBuYXZUcmVlKTtcbiAgICAkc2NvcGUuZGF0YUZvclRoZVRyZWUgPSBuYXZUcmVlO1xuXG4gICAgJHNjb3BlLnNlbGVjdGVkX25vZGUgPSBuYXZUcmVlWzFdO1xuICAgIFxuICAgICRzY29wZS5zaG93U2VsZWN0ZWQgPSBmdW5jdGlvbihub2RlKXtcbiAgICAgICAgJGxvZy5sb2coXCJzaG93U2VsZWN0ZWRcIiwgbm9kZSk7XG4gICAgICAgICRsb2NhdGlvbi51cmwobm9kZS51cmwpO1xuICAgICAgICBcbiAgICB9XG4gICAgXG59XSApO1xuXG4iLCJcbmFwcC5zZXJ2aWNlKCdhdXRoSGFzaCcsWyckaHR0cCcsICckbG9nJywgZnVuY3Rpb24oJGh0dHAsICRsb2cpe1xuICAgIHJldHVybiB7XG4gICAgICAgIGlzX2luaXRlZDpmYWxzZSxcbiAgICAgICAgX2hhc2g6bnVsbCxcbiAgICAgICAgX2luaXQ6ZnVuY3Rpb24oY2Ipe1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNfaW5pdGVkKXsgcmV0dXJuOyB9XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLl9oYXNoID0gJGh0dHAuZ2V0KCAnL215LWF1dGgtaGFzaC8nKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XG4gICAgICAgICAgICAgICAgLy8gJGxvZy5sb2coXCJhaFwiLCByZXNwKTtcbiAgICAgICAgICAgICAgICAvLyB0aGF0Ll9oYXNoID0gZGF0YS5oYXNoO1xuICAgICAgICAgICAgICAgIGNiKHJlc3AuZGF0YS5oYXNoLCByZXNwLmRhdGEudXNlcl9pZClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB0aGlzLmlzX2luaXRlZCA9IHRydWU7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiggY2IgKXtcbiAgICAgICAgICAgIHRoaXMuX2luaXQoIGNiIClcbiAgICAgICAgICAgIC8vJGxvZy5sb2coXCJMXCIsdGhpcy5xLCB0aGlzLl9oYXNoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNoOyBcbiAgICAgICAgfSxcbiAgICB9XG4gIH1dIClcblxuYXBwLmZhY3RvcnkoJ3NvY2tldCcsIFtcIiRyb290U2NvcGVcIiwgXCIkcVwiLCBcImF1dGhIYXNoXCIsZnVuY3Rpb24gKCRyb290U2NvcGUsJHEsIGF1dGhIYXNoKSB7XG4gICAgdmFyIHNvY2tldCA9IGlvLmNvbm5lY3QoKTtcbiAgICBpc19hdXRoZW50aWNhdGVkID0gJHEuZGVmZXIoKTtcbiAgICBzb2NrZXQub24oJ2Nvbm5lY3RlZCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVjb25uZWN0aW9uXCIpO1xuICAgICAgICBhdXRoSGFzaC5nZXQoZnVuY3Rpb24oaGFzaCwgdWlkKXtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KFwiYXV0aF9oYXNoX2NvbnNvbGVcIiwge2F1dGg6IGhhc2h9KTtcbiAgICAgICAgfSlcbiAgICB9KVxuICAgIHNvY2tldC5vbihcImF1dGhfY29tcGxldGVkXCIsIGZ1bmN0aW9uKG1zZyl7XG4gICAgICAgIGlmKG1zZy5lcnIpe1xuICAgICAgICAgICAgaXNfYXV0aGVudGljYXRlZC5yZWplY3QobXNnLmVycik7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgaXNfYXV0aGVudGljYXRlZC5yZXNvbHZlKCk7ICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfSlcbiAgICAvLyBjb25zb2xlLmxvZyhpc19hdXRoZW50aWNhdGVkKTtcbiAgICBpc19hdXRoZW50aWNhdGVkLnByb21pc2UudGhlbihmdW5jdGlvbigpe2NvbnNvbGUubG9nKFwiYXV0aFwiKX0pXG4gICAgXG4gICAgXG4gIHJldHVybiB7XG4gICAgZ2V0U3RhdGU6IGZ1bmN0aW9uKCl7cmV0dXJuIFwiZ29vZFwifSxcbiAgICBvbjogZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcbiAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsgIFxuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBlbWl0OiBmdW5jdGlvbiAoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xuICAgICAgXG4gICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZW1pdHRlZFwiKTtcbiAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICB9XG4gIH07XG59IF0pO1xuXG5hcHAuZmFjdG9yeShcInNvY2tldFByb21pc2VcIixbXCIkcVwiLCBcIiRyb290U2NvcGVcIiwgXCJhdXRoSGFzaFwiLCBmdW5jdGlvbiggJHEsICRyb290U2NvcGUsIGF1dGhIYXNoKXtcbiAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCgpO1xuICAgIHZhciBpc19yZWFkeSA9IGZhbHNlO1xuICAgIHZhciBRdWV1ZSA9IFtdO1xuICAgIFxuICAgIGlzX2F1dGhlbnRpY2F0ZWQgPSAkcS5kZWZlcigpO1xuICAgIHNvY2tldC5vbignY29ubmVjdGVkJywgZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZWNvbm5lY3Rpb25cIik7XG4gICAgICAgIGF1dGhIYXNoLmdldChmdW5jdGlvbihoYXNoLCB1aWQpe1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoXCJhdXRoX2hhc2hfY29uc29sZVwiLCB7YXV0aDogaGFzaH0pO1xuICAgICAgICB9KVxuICAgIH0pXG4gICAgc29ja2V0Lm9uKFwiYXV0aF9jb21wbGV0ZWRcIiwgZnVuY3Rpb24obXNnKXtcbiAgICAgICAgaWYobXNnLmVycil7XG4gICAgICAgICAgICBpc19hdXRoZW50aWNhdGVkLnJlamVjdChtc2cuZXJyKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIj4+XCIpO1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKXtpc19hdXRoZW50aWNhdGVkLnJlc29sdmUodHJ1ZSl9KVxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0pXG4gICAgLy8gY29uc29sZS5sb2coaXNfYXV0aGVudGljYXRlZCk7XG4gICAgaXNfYXV0aGVudGljYXRlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24ocyxlKXtcbiAgICAgICAgLy8gY29uc29sZS5sb2coaXNfYXV0aGVudGljYXRlZCwgcyxlKTtcbiAgICAgICAgaXNfcmVhZHkgPSB0cnVlO1xuICAgICAgICBmb3IodmFyIGkgPTA7aSA8UXVldWUubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoUXVldWVbaV0uVCwgUXVldWVbaV0ucCk7XG4gICAgICAgIH1cbiAgICB9KVxuICAgIFxuICAgIHZhciBTID0ge307XG4gICAgdmFyIGNicyA9IHt9O1xuICAgIHZhciBjdXJjYml4ID0gMDtcbiAgICBmdW5jdGlvbiBnZXRDQkl4KCl7XG4gICAgICAgIGN1cmNiaXgrPTE7XG4gICAgICAgIHJldHVybiBjdXJjYml4ICUgMTAwMDA7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgUmVxID0gZnVuY3Rpb24obXQsIHQsIHApe1xuICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCksXG4gICAgICAgIGNiaXggPSAgZ2V0Q0JJeCgpO1xuICAgICAgICBjYnNbY2JpeF0gPSB7XG4gICAgICAgICAgICBjYjogZFxuICAgICAgICB9XG4gICAgICAgIHZhciBvID0ge3A6cH07XG4gICAgICAgIG8uY2JpeCA9IGNiaXg7XG4gICAgICAgIG8uVCA9IHQ7XG4gICAgICAgIGlmKCFpc19yZWFkeSl7XG4gICAgICAgICAgICBRdWV1ZS5wdXNoKHtUOm10LHA6b30pO1xuICAgICAgICAgICAgXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgc29ja2V0LmVtaXQobXQsIG8pO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgIH1cbiAgICBcbiAgICB2YXIgbWVzc2FnZXNfdG9faGVhciA9IFtcIlFcIiwgXCJSXCJdO1xuICAgIGFuZ3VsYXIuZm9yRWFjaChtZXNzYWdlc190b19oZWFyLCBmdW5jdGlvbihtZXNzYWdlX3R5cGUpe1xuICAgICAgICBzb2NrZXQub24obWVzc2FnZV90eXBlLCBmdW5jdGlvbihtc2cpe1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj5cIiwgbXNnKTtcbiAgICAgICAgICAgIHZhciBjYml4ID0gbXNnLmNiaXg7XG4gICAgICAgICAgICBpZihjYnMuaGFzT3duUHJvcGVydHkoY2JpeCkpIHtcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShjYnNbY2JpeF0uY2IucmVzb2x2ZShtc2cuZCkpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBjYnNbY2JpeF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgIH0pXG4gICAgXG4gICAgUy5nZXQgPSBmdW5jdGlvbih0LHApe1xuICAgICAgICByZXR1cm4gUmVxKFwiUVwiLCB0LHApXG4gICAgfVxuICAgIFMucmVxdWVzdCA9IGZ1bmN0aW9uKHQscCl7XG4gICAgICAgIHJldHVybiBSZXEoXCJSXCIsIHQscClcbiAgICB9XG4gICAgcmV0dXJuIFM7XG59XSlcblxuYXBwLnNlcnZpY2UoXCJzb2NrZXRMaXN0ZW5lcnNcIixbJ3NvY2tldCcsIGZ1bmN0aW9uKHNvY2tldCl7XG4gICAgLy8g0JfQtNC10YHRjCDQvNGLINGF0L7RgtC40Lwg0YHQvtC30LTQsNGC0Ywg0YHQu9GD0LbQsdGLLCDQutC+0YLQvtGA0LDRjyDRgNC10LPQuNGB0YLRgNC40YDRg9C10YIg0L3QtdGB0LrQvtC70YzQutC+INC+0LHQvdC+0LLQu9C10L3QuNC5INC90LAg0LvRjtCx0YvQtSDQstGF0L7QtNGP0YnQuNC1IHNvY2tldC5pbyDQt9Cw0L/RgNC+0YHRi1xuICAgIHZhciBMaXN0ZW5lcnMgPSB7XG4gICAgICAgIF9saXN0ZW5lcnMgOiB7fVxuICAgIH1cbiAgICBMaXN0ZW5lcnMucmVnaXN0ZXIgPSBmdW5jdGlvbihldmVudFR5cGUsIGNiKSB7XG4gICAgICAgIGlmKHRoaXMuX2xpc3RlbmVyc1tldmVudFR5cGVdID09IG51bGwpe1xuICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzW2V2ZW50VHlwZV0gPSBbY2JdO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpc3RlbmVyc1tldmVudFR5cGVdLnB1c2goY2IpIC0gMTsgLy8gY3VycmVudCBpdGVtIGluZGV4XG4gICAgICAgIH1cbiAgICB9XG4gICAgc29ja2V0Lm9uKFwiV1wiLCBmdW5jdGlvbihtZXNzYWdlKXtcbiAgICAgICAgdmFyIG1lc3NhZ2VfdHlwZSA9IG1lc3NhZ2UudHlwZTtcbiAgICAgICAgXG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaChMaXN0ZW5lcnMuX2xpc3RlbmVyc1ttZXNzYWdlX3R5cGVdLCBmdW5jdGlvbihsaXN0ZW5lcil7XG4gICAgICAgICAgICBsaXN0ZW5lcihtZXNzYWdlKTtcbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgfSlcbiAgICBcbiAgICByZXR1cm4gTGlzdGVuZXJzO1xuICAgIFxuICAgIFxufV0pIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9